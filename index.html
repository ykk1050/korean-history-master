<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>역사의 선택: 광복을 향하여</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap');
        
        body {
            font-family: 'Nanum Myeongjo', serif;
            background-color: #f5f5f0;
            background-image: repeating-linear-gradient(45deg, #f5f5f0 25%, #ebebe0 25%, #ebebe0 50%, #f5f5f0 50%, #f5f5f0 75%, #ebebe0 75%, #ebebe0 100%);
            background-size: 20px 20px;
            color: #2c2c2c;
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-card {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            background-color: #ffffff;
            color: #44403c;
            border: 1px solid #d6d3d1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .btn-card:hover {
            transform: translateY(-2px);
            background-color: #fafaf9;
            border-color: #a8a29e;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .btn-card:active {
            transform: translateY(0);
            background-color: #f5f5f4;
        }

        .btn-special {
            background-color: #78350f !important;
            color: white !important;
            border-color: #78350f !important;
        }

        /* 시대별 뱃지 스타일 */
        .badge-ancient { background-color: #eab308; color: #fff; } /* 고대 */
        .badge-goguryeo { background-color: #b91c1c; color: #fff; } /* 고구려 (붉은 기상) */
        .badge-goryeo { background-color: #0d9488; color: #fff; } /* 고려 (청자색) */
        .badge-joseon { background-color: #1d4ed8; color: #fff; } /* 조선 (청색) */
        .badge-modern { background-color: #4b5563; color: #fff; } /* 근대/일제 */
        .badge-crisis { background-color: #dc2626; color: #fff; animation: pulse 2s infinite; } /* 위기 상황 */

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .title-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .title-item.locked {
            color: #aaa;
            filter: grayscale(100%);
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 12px 24px;
            border-radius: 24px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 200;
            pointer-events: none;
        }

        /* 미니게임 스타일 */
        #minigame-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            background-image: url('dangunbackground.png');
            background-size: cover;
            background-position: center;
            z-index: 300;
        }
        .falling-item {
            position: absolute;
            width: 80px;
            height: 80px;
            cursor: pointer;
            object-fit: contain;
            animation: fall linear forwards;
            user-select: none;
            touch-action: manipulation; 
        }
        @keyframes fall {
            from { top: -100px; transform: rotate(0deg); }
            to { top: 110vh; transform: rotate(360deg); }
        }
        .score-popup {
            position: absolute;
            font-size: 32px;
            font-weight: bold;
            pointer-events: none;
            animation: popup 0.8s ease-out forwards;
            z-index: 310;
            text-shadow: 2px 2px 0 #000;
        }
        @keyframes popup {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-2 md:p-4 gap-4">
    <!-- 웅녀 미니게임 오버레이 -->
    <div id="minigame-overlay">
        <!-- 점수판 -->
        <div class="absolute top-4 left-4 bg-black/60 text-white p-4 rounded-lg z-10 border border-white/30 backdrop-blur-sm">
            <div class="text-3xl font-bold mb-2 text-yellow-400">인내심: <span id="mg-score">0</span> / 100</div>
            <div class="text-sm text-gray-200">
                <span class="text-green-400 font-bold">● 쑥 & 마늘: +1점</span><br>
                <span class="text-red-400 font-bold">● 고기 & 술: -1점</span>
            </div>
        </div>
        
        <!-- 게임 영역 -->
        <div id="mg-game-area" class="w-full h-full absolute top-0 left-0 overflow-hidden"></div>

        <!-- 결과 메시지 -->
        <div id="mg-result" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-50 text-white text-center p-8 transition-opacity duration-500">
            <h2 class="text-5xl font-bold mb-8 text-yellow-400 animate-bounce">🐻 인내의 결실 🎉</h2>
            <p class="text-2xl mb-12 leading-loose">
                곰이 사람으로 변하는데 성공하여<br>
                환웅과 결혼하고,<br>
                <span class="font-bold text-yellow-200">단군왕검</span>이 태어나<br>
                고조선을 세웠습니다!
            </p>
            <button id="mg-proceed-btn" class="px-10 py-5 bg-blue-600 hover:bg-blue-500 text-white rounded-full text-2xl font-bold transition transform hover:scale-105 shadow-xl border-4 border-blue-400">
                역사 계속하기 ▶
            </button>
        </div>
    </div>

    <div class="max-w-4xl w-full bg-white rounded-xl shadow-2xl overflow-hidden border border-stone-300 relative fade-in" id="game-container">
        
        <!-- 상단 헤더 -->
        <div class="bg-stone-900 text-stone-200 px-6 py-4 flex justify-between items-center shadow-md z-10 relative">
            <div class="flex flex-col">
                <span id="current-era-badge" class="text-xs font-bold px-2 py-1 rounded mb-1 w-fit bg-stone-600">시대 미정</span>
                <span id="scene-title-header" class="font-bold text-lg md:text-xl text-stone-100">게임 시작</span>
            </div>
            <div class="text-right flex flex-col items-end">
                <span id="game-year" class="block text-2xl font-serif text-amber-500 font-bold">START</span>
                <button onclick="showTitles()" class="text-xs text-stone-400 hover:text-stone-200 underline mt-1">🏆 업적 보기</button>
            </div>
        </div>

        <!-- 진행바 -->
        <div class="w-full bg-stone-200 h-2">
            <div class="bg-amber-700 h-2 transition-all duration-500 ease-out relative" id="progress-bar" style="width: 0%"></div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="p-6 md:p-10 flex flex-col md:flex-row gap-8">
            
            <!-- 왼쪽: 이미지/아이콘 영역 -->
            <div class="md:w-1/4 flex flex-col items-center justify-start pt-4">
                <div id="scene-icon" class="w-24 h-24 md:w-32 md:h-32 rounded-full bg-stone-50 flex items-center justify-center text-6xl md:text-7xl shadow-inner border-4 border-stone-200 mb-4">
                    📜
                </div>
                <div class="text-center text-stone-500 text-sm font-bold" id="era-name">역사의 서막</div>
            </div>

            <!-- 오른쪽: 텍스트 및 선택지 -->
            <div class="md:w-3/4">
                <div class="bg-stone-50 p-6 rounded-lg border border-stone-200 mb-6 shadow-sm relative">
                    <span class="absolute top-0 left-0 text-4xl text-stone-200 p-2 transform -translate-y-2 -translate-x-2">❝</span>
                    <p id="scene-desc" class="text-lg leading-loose text-stone-800 break-keep text-justify relative z-10">
                        환영합니다. 당신은 이제 반만년 역사의 결정적인 순간마다 개입하게 됩니다.<br><br>
                        교과서의 요약된 문장이 아닌, 생생한 역사의 현장 속에서 고뇌하는 지도자가 되어주십시오. 당신의 선택 하나하나가 이 땅의 운명을 바꿀 것입니다.
                    </p>
                </div>

                <!-- 선택지 영역 -->
                <div id="choices" class="space-y-3">
                    <button onclick="startGame()" class="w-full py-4 px-6 rounded-lg font-bold text-lg btn-card border-stone-400 text-stone-800 shadow-md">
                        역사의 대장정 시작하기
                    </button>
                </div>
            </div>
        </div>

        <!-- 하단 푸터 -->
        <div class="bg-stone-100 p-3 text-center text-xs text-stone-400 border-t border-stone-200 flex justify-between px-8">
            <span>⚜️ 한국사 대서사시</span>
            <span id="turn-count">Turn: 0</span>
        </div>
    </div>

    <!-- 업적 모달 -->
    <div id="title-modal" class="modal" onclick="closeTitles(event)">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-stone-800 border-b pb-2">🏆 획득한 칭호</h2>
            <div id="title-list" class="space-y-2">
                <!-- 칭호 목록이 여기에 표시됨 -->
            </div>
            <button onclick="document.getElementById('title-modal').style.display='none'" class="mt-6 w-full py-2 bg-stone-600 text-white rounded hover:bg-stone-700">닫기</button>
        </div>
    </div>

    <!-- 토스트 메시지 -->
    <div id="toast" class="toast">칭호 획득!</div>

    <div class="text-xs text-stone-400 opacity-70 mt-2 font-sans select-none">
        역사의 선택: 광복을 향해서 made by gamtudyssam 0.001
    </div>

    <script>
        // 칭호 데이터
        const titles = {
            'first_step': { name: '역사의 첫걸음', desc: '게임 시작하기' },
            // 'sea_king' 제거 (장보고 삭제됨)
            'great_scientist': { name: '과학 군주', desc: '장영실을 등용하여 조선의 과학을 꽃피우다' },
            'reformer': { name: '개혁가', desc: '정조의 꿈을 이루다' },
            'patriot': { name: '애국지사', desc: '국채보상운동에 참여하다' },
            'traitor': { name: '매국노', desc: '나라를 팔아먹다 (배드엔딩)' },
            'tyrant': { name: '폭군', desc: '백성을 억압하다 (배드엔딩)' },
            // 'pirate_king' 제거 (장보고 삭제됨)
            'history_guardian': { name: '역사의 수호자', desc: '광복을 맞이하다 (트루엔딩)' }
        };

        // 로컬 스토리지에서 획득한 칭호 불러오기
        let unlockedTitles = JSON.parse(localStorage.getItem('koreanHistoryTitles')) || [];

        function unlockTitle(id) {
            if (!titles[id]) return;
            if (!unlockedTitles.includes(id)) {
                unlockedTitles.push(id);
                localStorage.setItem('koreanHistoryTitles', JSON.stringify(unlockedTitles));
                showToast(`🏆 칭호 획득: ${titles[id].name}`);
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.style.opacity = 1;
            setTimeout(() => {
                toast.style.opacity = 0;
            }, 3000);
        }

        function showTitles() {
            const list = document.getElementById('title-list');
            list.innerHTML = '';
            
            Object.keys(titles).forEach(key => {
                const item = titles[key];
                const isUnlocked = unlockedTitles.includes(key);
                const div = document.createElement('div');
                div.className = `title-item ${isUnlocked ? '' : 'locked'}`;
                div.innerHTML = `
                    <div>
                        <div class="font-bold">${isUnlocked ? item.name : '???'}</div>
                        <div class="text-xs text-stone-500">${isUnlocked ? item.desc : '아직 획득하지 못함'}</div>
                    </div>
                    <div class="text-2xl">${isUnlocked ? '🏅' : '🔒'}</div>
                `;
                list.appendChild(div);
            });

            document.getElementById('title-modal').style.display = 'flex';
        }

        function closeTitles(e) {
            if (e.target === document.getElementById('title-modal')) {
                document.getElementById('title-modal').style.display = 'none';
            }
        }

        const gameData = {
            // ==========================================
            // 1. 고조선 및 초기 국가
            // ==========================================
            start: {
                type: 'history', badge: 'badge-ancient', era: "고조선", year: "BC 2333",
                title: "개국: 하늘의 뜻을 잇다",
                desc: "하늘을 다스리는 환웅이 신시를 열고 인간 세상을 보살피고 있습니다. 어느 날, 곰과 호랑이가 찾아와 간절히 사람이 되기를 청합니다. 인간이 되는 길은 험난하지만, 이들을 잘 이끈다면 홍익인간의 뜻을 널리 펼칠 수 있을 것입니다.",
                progress: 2, icon: "🐻",
                unlock: 'first_step',
                choices: [
                    { text: "쑥과 마늘을 주며 100일간 동굴에서 인내하라고 한다.", next: "gojoseon_law", minigame: 'bear_game' },
                    { text: "강력한 맹수의 힘이 필요하니 군사로 키운다.", next: "crisis_beast" },
                    { text: "가엽게 여겨 마법을 써서 바로 사람으로 만들어 준다.", next: "crisis_easy_magic" }
                ]
            },
            crisis_beast: { 
                type: 'crisis', badge: 'badge-crisis', title: "위기: 야수의 왕국", 
                desc: "짐승의 본성을 버리지 못한 그들은 인간을 돕기는커녕 잡아먹기 시작했습니다. 신시가 피로 물들고 사람들은 공포에 떨고 있습니다. 환웅의 권위가 땅에 떨어졌습니다.", 
                choices: [
                    { text: "신성한 힘(천부인)으로 짐승을 제압하고 늦게나마 법과 질서를 세운다.", next: "gojoseon_law" }, // 회복
                    { text: "모든 것을 포기하고 다시 하늘로 돌아간다.", next: "end_myth_fail" },
                    { text: "더 강력한 사자 군단을 데려와 서로 싸우게 한다.", next: "end_savage" }
                ] 
            },
            crisis_easy_magic: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 덜 된 인간",
                desc: "인내와 고난의 과정 없이 겉모습만 사람이 된 그들은 인간의 도리를 모릅니다. 욕심을 부리고 난폭하게 날뛰며 세상을 어지럽히고 있습니다.",
                choices: [
                    { text: "엄격한 금기를 만들어 그들에게 인내심과 도덕을 다시 가르친다.", next: "gojoseon_law" }, // 회복
                    { text: "실패작이라 여기고 모두 죽여 없앤다.", next: "end_savage" },
                    { text: "그들을 풀어주어 세상에 혼란을 야기한다.", next: "end_myth_fail" }
                ]
            },
            
            gojoseon_law: {
                type: 'history', badge: 'badge-ancient', era: "고조선", year: "기원전",
                title: "금법의 제정",
                desc: "농경이 발달하고 청동기 문화를 바탕으로 고조선 사회는 점점 커지고 복잡해졌습니다. 사람들의 재산을 보호하고 사회 질서를 바로잡기 위해서는 강력한 사회적 합의가 필요합니다.",
                progress: 5, icon: "⚖️",
                choices: [
                    { text: "생명과 사유 재산을 중시하는 8개의 법(8조법)을 만든다.", next: "goguryeo_jumong" },
                    { text: "모든 것은 공동 소유로 하고 개인의 재산을 금지한다.", next: "crisis_commune" },
                    { text: "힘센 자가 모든 것을 가지는 약육강식의 법을 만든다.", next: "end_savage" }
                ]
            },
            crisis_commune: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 멈춰버린 발전",
                desc: "내가 열심히 일해서 얻은 곡식도 내 것이 아니니, 아무도 농사를 열심히 짓지 않습니다. 식량이 부족해지고 문명의 발전이 멈췄습니다. 사람들은 배고픔에 시달립니다.",
                choices: [
                    { text: "지금이라도 사유 재산을 인정하고 열심히 일한 자에게 보상을 준다.", next: "goguryeo_jumong" }, // 회복
                    { text: "게으른 자들을 본보기로 모두 처형한다.", next: "end_tyrant" },
                    { text: "부족한 식량을 채우기 위해 옆 부족을 약탈한다.", next: "end_savage" }
                ]
            },

            // ==========================================
            // 2. 삼국 시대 - 고구려
            // ==========================================
            goguryeo_jumong: {
                type: 'history', badge: 'badge-goguryeo', era: "고구려", year: "BC 37",
                title: "새로운 나라의 건국",
                desc: "부여의 왕자들에게 시기를 받아 쫓겨난 주몽은 압록강 유역의 졸본에 도착했습니다. 이곳은 산세가 험하지만 방어하기 좋습니다. 이제 새로운 나라를 세워야 합니다. 어떤 기상을 품으시겠습니까?",
                progress: 8, icon: "🏹",
                choices: [
                    { text: "활 쏘기와 기마술을 중시하는 상무 정신으로 '고구려'를 세운다.", next: "baekje_geunchogo" },
                    { text: "부여에 항복하고 다시 돌아가 왕자 자리를 노린다.", next: "end_buyeo_sub" },
                    { text: "싸움이 싫으니 농사만 짓는 평화로운 소국을 세운다.", next: "crisis_weak_state" },
                    { text: "신라의 박혁거세, 백제의 온조와 함께 알에서 태어난 신성함을 강조한다.", next: "baekje_geunchogo" }
                ]
            },
            crisis_weak_state: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 약소국의 비애",
                desc: "무력을 포기하고 평화만 외치자, 주변의 한나라 군현과 선비족이 우리를 만만하게 보고 매일같이 약탈해 갑니다. 백성들은 집과 가족을 잃고 울부짖고 있습니다.",
                choices: [
                    { text: "빼앗긴 것을 되찾기 위해 군사를 기르고 국방을 강화한다.", next: "baekje_geunchogo" }, // 회복
                    { text: "그들에게 조공을 바치고 제발 봐달라고 빈다.", next: "end_vassal_generic" },
                    { text: "나라를 버리고 더 깊은 산속으로 숨는다.", next: "end_fail_founding" }
                ]
            },
            
            baekje_geunchogo: {
                type: 'history', badge: 'badge-ancient', era: "백제", year: "4세기",
                title: "해상 왕국 백제",
                desc: "한강 유역에서 시작한 백제가 근초고왕 때에 이르러 전성기를 맞이했습니다. 넓은 평야와 바다가 우리 앞에 있습니다. 백제의 배가 어디로 향해야 국력을 더욱 떨칠 수 있을까요?",
                progress: 12, icon: "⛵",
                choices: [
                    { text: "북으로 고구려를 견제하고, 바다 건너 중국(요서)과 일본(규슈)으로 진출한다.", next: "goguryeo_gwanggaeto" },
                    { text: "안전이 최우선이다. 성 문을 닫고 외국과의 교류를 끊는다.", next: "crisis_baekje_isolation" },
                    { text: "신라를 공격하여 경주를 불바다로 만든다.", next: "crisis_early_war" }
                ]
            },
            crisis_baekje_isolation: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 고립된 백제",
                desc: "무역이 끊기자 백제의 경제가 마비되었습니다. 선진 문물을 받아들이지 못해 기술이 뒤쳐지고, 귀족들은 왕의 소심한 정책에 불만을 품고 있습니다.",
                choices: [
                    { text: "다시 바닷길을 열고 활발한 정복 활동을 시작하여 귀족들의 불만을 잠재운다.", next: "goguryeo_gwanggaeto" }, // 회복
                    { text: "반대하는 귀족들을 모두 죽여 공포 정치를 한다.", next: "end_tyrant" },
                    { text: "강력한 고구려에 도움을 요청하고 땅을 떼어준다.", next: "end_vassal_goguryeo" }
                ]
            },
            crisis_early_war: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 빈집털이",
                desc: "신라를 공격하러 주력군이 빠져나간 사이, 북쪽에서 고구려가 텅 빈 우리 국경을 넘어 쳐들어왔습니다. 수도가 함락될 위기입니다!",
                choices: [
                    { text: "군대를 급히 돌려 고구려군을 막아내고 전선을 재정비한다.", next: "goguryeo_gwanggaeto" }, // 회복
                    { text: "신라 공격에 모든 것을 건다. 뒤는 생각하지 않는다.", next: "end_savage" },
                    { text: "배를 타고 일본으로 도망친다.", next: "end_exile_ancient" }
                ]
            },
            
            goguryeo_gwanggaeto: {
                type: 'history', badge: 'badge-goguryeo', era: "고구려", year: "391년~",
                title: "광개토대왕의 웅비",
                desc: "고구려의 광개토대왕은 '영락'이라는 독자적인 연호를 사용하며 대제국을 건설하고자 합니다. 사방에 적들이 있지만, 우리 기병의 말발굽 소리는 대지를 울립니다. 어디를 먼저 공략하시겠습니까?",
                progress: 15, icon: "🐎",
                choices: [
                    { text: "북으로 만주를 호령하고, 남으로 내려가 신라를 괴롭히는 왜구를 격퇴한다.", next: "shilla_growth" },
                    { text: "백제와 손잡고 신라를 협공하여 한반도 남부를 나눠 가진다.", next: "crisis_shilla_fall" },
                    { text: "중국 본토 깊숙이 쳐들어가 중원의 황제가 되려 한다.", next: "crisis_over_extension" }
                ]
            },
            crisis_shilla_fall: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 깨진 균형",
                desc: "신라를 멸망시켰지만, 백제가 약속을 어기고 신라 땅을 독차지한 뒤 고구려의 배후를 위협합니다. 믿었던 도끼에 발등 찍힌 꼴이 되었습니다.",
                choices: [
                    { text: "배신자 백제를 응징하고 한강 이북의 패권을 확고히 한다.", next: "shilla_growth" }, // 회복
                    { text: "백제의 세력이 너무 커졌다. 항복한다.", next: "end_vassal_baekje" },
                    { text: "남쪽 땅을 모두 포기하고 만주로만 나아간다.", next: "crisis_weak_state" }
                ]
            },
            crisis_over_extension: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 보급로 차단",
                desc: "너무 깊이 들어갔습니다. 보급로가 끊기고 병사들은 지쳐 쓰러집니다. 중국의 대군이 포위망을 좁혀오고 있습니다. 고구려 본토가 위험합니다.",
                choices: [
                    { text: "욕심을 버리고 신속히 철군하여 요동 방어선을 굳건히 한다.", next: "shilla_growth" }, // 회복
                    { text: "목숨을 걸고 앞으로 돌격한다.", next: "end_bad_tactic" },
                    { text: "적장에게 항복하고 그의 부하가 된다.", next: "end_vassal_generic" }
                ]
            },

            shilla_growth: {
                type: 'history', badge: 'badge-ancient', era: "신라", year: "6세기",
                title: "신라의 도약과 진흥왕",
                desc: "신라는 삼국 중 가장 늦게 발전했지만, 법흥왕이 불교를 공인하고 진흥왕이 화랑도를 정비하며 전성기를 맞이했습니다. 진흥왕은 한강 유역을 차지하고 북한산에 순수비를 세웠습니다.",
                progress: 17, icon: "👑",
                choices: [
                    { text: "화랑도를 국가적 조직으로 키우고, 중국과 직접 교류하여 삼국 통일의 기반을 닦는다.", next: "goguryeo_salsu" },
                    { text: "백제와의 동맹을 끝까지 믿고 한강을 포기한다.", next: "crisis_stagnant_shilla" },
                    { text: "고구려의 힘이 강력하니 조공을 바치며 나중에 역전을 노린다.", next: "end_weakness" }
                ]
            },
            crisis_stagnant_shilla: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 갇혀버린 신라",
                desc: "한강을 차지하지 못한 신라는 중국으로 가는 뱃길이 막혔습니다. 백제는 더욱 강성해져 신라를 위협하고, 신라는 영원히 변방의 작은 나라로 남을 위기입니다.",
                choices: [
                    { text: "늦게나마 동맹을 깨고 한강 유역을 공격한다.", next: "goguryeo_salsu" }, // 회복
                    { text: "백제에 머리를 숙이고 나중에 역전을 노린다.", next: "end_vassal_baekje" },
                    { text: "산속으로 들어가 숨는다.", next: "end_coward" }
                ]
            },

            goguryeo_salsu: {
                type: 'history', badge: 'badge-goguryeo', era: "고구려", year: "612년",
                title: "살수대첩",
                desc: "중국을 통일한 수나라가 113만이라는 어마어마한 대군을 이끌고 고구려를 침공했습니다. 정면 승부로는 승산이 없습니다. 을지문덕 장군, 나라의 운명이 당신의 손에 달렸습니다.",
                progress: 18, icon: "🌊",
                choices: [
                    { text: "거짓 패배로 적을 깊숙이 유인하여 지치게 한 뒤, 살수(강)를 건널 때 수장시킨다.", next: "shilla_unification" },
                    { text: "평양성 앞에 전 병력을 모아 정면 승부를 건다.", next: "crisis_pyongyang_siege" },
                    { text: "승산이 없다. 항복하여 나라를 보존하는 것이 낫다.", next: "end_sui_colony" }
                ]
            },
            crisis_pyongyang_siege: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 평양성 포위",
                desc: "수나라 별동대 30만에게 평양성이 완전히 포위되었습니다. 성안의 식량은 바닥나고, 백성들은 굶주림과 공포에 떨고 있습니다.",
                choices: [
                    { text: "적장 우중문에게 거짓 항복 편지를 보내 방심시킨 틈을 타 기습한다.", next: "shilla_unification" }, // 회복
                    { text: "성문을 열고 무조건 항복한다.", next: "end_sui_colony" },
                    { text: "백성들의 식량을 뺏어 군대만 먹이고 버틴다.", next: "end_tyrant" }
                ]
            },

            // ==========================================
            // 3. 남북국 시대
            // ==========================================
            shilla_unification: {
                type: 'history', badge: 'badge-ancient', era: "신라", year: "676년",
                title: "나당전쟁과 삼국통일",
                desc: "신라가 당나라와 연합하여 백제와 고구려를 무너뜨렸습니다. 그러나 동맹이었던 당나라가 본색을 드러냈습니다. 그들은 약속을 어기고 한반도 전체를 자신들의 지배하에 두려 합니다. 어제의 동지가 오늘의 적이 되었습니다.",
                progress: 22, icon: "👑",
                choices: [
                    { text: "외세의 지배를 받을 순 없다. 당나라와 전쟁을 벌여 그들을 몰아낸다.", next: "balhae_founding" },
                    { text: "대국인 당나라와 싸워 이길 수 없다. 지배를 인정하고 스스로 나라를 다스릴 권리만 얻는다.", next: "end_tang_vassal" },
                    { text: "고구려 유민들이 우리에게 복수하기 위해 당나라와 손잡을지 모른다. 아직 군대를 만들지 못한 그들을 먼저 공격한다.", next: "crisis_internal_war" }
                ]
            },
            crisis_internal_war: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 내전의 늪",
                desc: "같은 민족인 고구려 유민을 적으로 돌리자, 그들은 살기 위해 당나라와 손잡고 신라를 공격해옵니다. 당나라를 몰아내기도 벅찬데 내부의 적까지 생겼습니다.",
                choices: [
                    { text: "유민들을 포용하고 힘을 합쳐 당나라를 몰아내자고 설득한다.", next: "balhae_founding" }, // 회복
                    { text: "끝까지 동족끼리 싸우는 비극을 벌인다.", next: "end_savage" },
                    { text: "당나라에 뇌물을 주고 평화를 산다.", next: "end_tang_vassal" }
                ]
            },

            balhae_founding: {
                type: 'history', badge: 'badge-goguryeo', era: "발해", year: "698년",
                title: "해동성국 발해",
                desc: "고구려가 멸망한 지 30년, 고구려 유민 대조영은 당나라의 추격을 따돌리고 동모산에 터를 잡았습니다. 이제 새로운 나라를 선포하려 합니다. 우리는 누구의 역사를 잇는 나라입니까?",
                progress: 25, icon: "🏰",
                choices: [
                    { text: "나라 이름을 '발해'라 하고, 당당히 고구려 계승을 천명한다.", next: "later_three_kingdoms" },
                    { text: "말갈족이 많으니 말갈의 나라임을 선포하고 고구려와 선을 긋는다.", next: "crisis_identity" },
                    { text: "당나라에 항복하여 장군으로 편하게 여생을 보낸다.", next: "end_no_balhae" }
                ]
            },
            crisis_identity: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 쪼개진 마음",
                desc: "고구려 유민들이 '우리의 나라가 아니다'라며 반발하여 떠나려 합니다. 나라가 세워지기도 전에 둘로 쪼개질 위기입니다. 국력이 모이지 않습니다.",
                choices: [
                    { text: "고구려와 말갈을 아우르는 융합 정책을 펴서 모두를 포용한다.", next: "later_three_kingdoms" }, // 회복
                    { text: "반발하는 고구려 유민을 모두 추방한다.", next: "end_weakness" },
                    { text: "나라를 해체하고 각자 부족 단위로 돌아간다.", next: "end_no_balhae" }
                ]
            },

            later_three_kingdoms: {
                type: 'history', badge: 'badge-ancient', era: "후삼국", year: "900년경",
                title: "후삼국의 혼란",
                desc: "신라의 국운이 기울자, 견훤은 후백제를, 궁예는 후고구려를 세워 천하는 다시 셋으로 나뉘었습니다. 영웅들이 패권을 다투는 혼란의 시기, 백성들은 평화로운 세상을 갈망합니다.",
                progress: 28, icon: "⚔️",
                choices: [
                    { text: "폭정을 일삼는 궁예를 몰아내고, 덕망 높은 왕건을 새 왕으로 추대한다.", next: "goryeo_wanggeon" },
                    { text: "견훤과 손잡고 신라를 멸망시킨다.", next: "crisis_ally_gyeonhwon" },
                    { text: "신라의 마지막 충신으로 남아 끝까지 저항한다.", next: "end_weakness" }
                ]
            },
            crisis_ally_gyeonhwon: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 잔혹한 점령군",
                desc: "견훤과 손잡고 신라의 수도 금성(지금의 경주)을 함락시켰으나, 견훤은 약속을 어기고 왕을 살해하며 백성들을 잔혹하게 유린했습니다. 신라의 민심은 당신을 침략자로 여기며 등을 돌렸고, 견훤은 이제 당신까지 위협합니다.",
                choices: [
                    { text: "견훤의 만행을 규탄하고, 신라의 유민들을 보호하며 민심을 되돌린다.", next: "goryeo_wanggeon" }, // 회복
                    { text: "견훤의 힘이 강하니 그의 신하가 되어 민족의 힘을 기르는데 나의 능력을 바친다.", next: "end_traitor" },
                    { text: "모든 것을 버리고 산속으로 도망친다.", next: "end_coward" }
                ]
            },

            // ==========================================
            // 4. 고려 시대
            // ==========================================
            goryeo_wanggeon: {
                type: 'history', badge: 'badge-goryeo', era: "고려", year: "918년",
                title: "고려 건국",
                desc: "후삼국의 혼란을 잠재우고 왕건이 고려를 세웠습니다. 하지만 지방에는 여전히 강력한 사병을 거느린 호족들이 버티고 있습니다. 이들을 어떻게 다스려야 진정한 통일을 이룰 수 있을까요?",
                progress: 30, icon: "💍",
                choices: [
                    { text: "정략 결혼으로 호족들을 가족으로 만들고, 북진 정책으로 비전을 제시한다.", next: "goryeo_seohee" },
                    { text: "호족들을 모두 반역자로 몰아 처형하여 강력한 왕권을 세운다.", next: "crisis_rebellion" },
                    { text: "신라의 골품제를 그대로 받아들여 귀족 중심 사회를 만든다.", next: "crisis_stagnation" }
                ]
            },
            crisis_rebellion: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 호족들의 반란",
                desc: "무리한 숙청에 위기감을 느낀 호족들이 연합하여 반란을 일으켰습니다. 갓 세운 왕조가 무너질 위기입니다.",
                choices: [
                    { text: "유화책(사심관, 기인 제도)을 통해 그들에게 책임을 주고 달랜다.", next: "goryeo_seohee" }, // 회복
                    { text: "반란군과 끝까지 싸우다 장렬히 전사한다.", next: "end_bad_tactic" },
                    { text: "왕위를 버리고 절로 들어간다.", next: "end_weakness" }
                ]
            },
            crisis_stagnation: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 고인 물",
                desc: "신분제를 그대로 유지하자 능력 있는 인재들이 등용되지 못하고 불만이 쌓입니다. 새 나라를 세운 의미가 퇴색되었습니다.",
                choices: [
                    { text: "과거제를 도입하여 신분에 상관없이 능력 있는 인재를 뽑는다.", next: "goryeo_seohee" }, // 회복 (광종 생략 후 서희로 연결)
                    { text: "불만을 가진 자들을 무력으로 탄압한다.", next: "end_tyrant" },
                    { text: "나라를 다시 3개로 쪼갠다.", next: "end_savage" }
                ]
            },

            goryeo_seohee: {
                type: 'history', badge: 'badge-goryeo', era: "고려", year: "993년",
                title: "서희의 외교 담판",
                desc: "거란(요)의 장수 소손녕이 80만 대군을 이끌고 침공했습니다. 조정 대신들은 겁에 질려 항복하거나 땅을 떼어주자고 합니다. 적의 의도를 파악한 서희가 나섭니다.",
                progress: 36, icon: "🗣️",
                choices: [
                    { text: "거란이 송나라와의 관계를 끊길 원함을 간파하고, 담판을 통해 강동 6주를 얻어낸다.", next: "goryeo_ganggamchan" },
                    { text: "싸울 힘이 없다. 요구대로 서경 이북의 땅을 떼어주고 화친한다.", next: "crisis_land_loss" },
                    { text: "무조건 항복하여 목숨이라도 부지한다.", next: "end_colony_khitan" }
                ]
            },
            crisis_land_loss: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 끝없는 요구",
                desc: "땅을 떼어주자 거란은 고려를 겁쟁이라 여겨 더 많은 땅과 공물을 요구해옵니다. 한 번의 양보가 호랑이를 불러들였습니다.",
                choices: [
                    { text: "지금이라도 강경하게 맞서 싸우고 외교적 실리를 찾는다.", next: "goryeo_ganggamchan" }, // 회복
                    { text: "한 번에 나라가 멸망하는 일이 없도록 조금씩 땅을 더 떼어준다.", next: "end_colony_khitan" },
                    { text: "송나라(고려시대 중국에 있던 국가)로 도망친다.", next: "end_coward" }
                ]
            },

            goryeo_ganggamchan: {
                type: 'history', badge: 'badge-goryeo', era: "고려", year: "1019년",
                title: "귀주 대첩",
                desc: "거란이 약속을 어기고 3차 침입을 감행했습니다. 소배압의 10만 정예군이 개경을 노리고 달려옵니다. 강감찬 장군은 귀주 벌판에서 적을 맞이할 준비를 마쳤습니다.",
                progress: 40, icon: "⚔️",
                choices: [
                    { text: "강물을 막아 적을 혼란시킨 뒤, 매복한 군사로 궤멸시킨다.", next: "goryeo_yoongwan" },
                    { text: "공격하지 않고 가만히 두면 돌아갈 적이니 곱게 보내주어 평화를 얻는 길을 택한다.", next: "crisis_khitan_return" },
                    { text: "수도를 버리고 남쪽으로 도망간다.", next: "crisis_capital_lost" }
                ]
            },
            crisis_khitan_return: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 거란의 재침입",
                desc: "적을 살려 보내자 그들은 정비 후 다시 쳐들어와 국토를 유린합니다. 자비가 화를 불렀습니다.",
                choices: [
                    { text: "나성을 쌓고 천리장성을 축조하여 철통 방어 태세를 갖춘다.", next: "goryeo_yoongwan" }, // 회복
                    { text: "항복한다.", next: "end_colony_khitan" },
                    { text: "적군을 잘 달래 연합한다.", next: "end_traitor" }
                ]
            },
            crisis_capital_lost: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 불타는 개경",
                desc: "수도를 버리자 백성들의 신망을 잃었고, 거란군은 텅 빈 개경을 불태웠습니다. 왕의 권위가 바닥에 떨어졌습니다.",
                choices: [
                    { text: "각지에서 의병을 모아 적의 보급로를 끊고 끈질기게 반격한다.", next: "goryeo_yoongwan" }, // 회복
                    { text: "섬으로 숨어 평생 나오지 않는다.", next: "end_coward" },
                    { text: "거란의 신하가 되겠다고 맹세한다.", next: "end_colony_khitan" }
                ]
            },

            goryeo_yoongwan: {
                type: 'history', badge: 'badge-goryeo', era: "고려", year: "1107년",
                title: "윤관과 별무반",
                desc: "북방의 여진족이 성장하여 고려의 국경을 위협하고 있습니다. 기병 위주의 여진족을 상대하기 위해 윤관 장군은 보병 중심의 고려군을 개편해야 한다고 주장합니다.",
                progress: 43, icon: "🛡️",
                choices: [
                    { text: "신기군(기병), 신보군(보병), 항마군(승병)으로 구성된 특수 부대 '별무반'을 조직하여 여진을 정벌하고 9성을 쌓는다.", next: "goryeo_sambyeolcho" },
                    { text: "평화가 최우선이다. 여진족에게 곡식을 바치고 달랜다.", next: "end_vassal_jurchen" },
                    { text: "공격할 능력이 부족하니 방어만 한다.", next: "crisis_jurchen_plunder" }
                ]
            },
            crisis_jurchen_plunder: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 여진의 유린",
                desc: "방어만 하는 소극적인 태도를 보이자 여진족은 고려를 얕잡아보고 국경을 넘어와 마을을 불태우고 약탈합니다. 백성들의 원성이 하늘을 찌릅니다.",
                choices: [
                    { text: "지금이라도 별무반을 조직하여 강력한 토벌에 나선다.", next: "goryeo_sambyeolcho" }, // 회복
                    { text: "여진족에게 땅을 떼어주고 평화를 요구한다.", next: "end_vassal_jurchen" },
                    { text: "도망친다.", next: "end_coward" }
                ]
            },

            goryeo_sambyeolcho: {
                type: 'history', badge: 'badge-goryeo', era: "고려", year: "1231년~",
                title: "대몽 항쟁",
                desc: "세계 최강의 몽골 제국이 침략했습니다. 육지에서는 승산이 없어 조정은 강화도로 천도했습니다. 백성들은 유린당하고 있습니다. 우리는 어떻게 저항해야 합니까?",
                progress: 46, icon: "☸️",
                choices: [
                    { text: "부처의 힘으로 국난을 극복하고자 팔만대장경을 만들고, 삼별초는 끝까지 항전한다.", next: "goryeo_gongmin" },
                    { text: "몽골에 즉시 항복하고 그들의 풍습(변발, 호복)을 모두 받아들인다.", next: "crisis_mongol_culture" },
                    { text: "몽골군과 연합하여 일본을 정벌하러 떠난다.", next: "crisis_japan_invasion" }
                ]
            },
            crisis_mongol_culture: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 정체성 상실",
                desc: "모두가 몽골식 머리를 하고 몽골 옷을 입으며 고려의 고유한 문화가 사라질 위기입니다. 나라는 남았으나 정신은 식민지가 되었습니다.",
                choices: [
                    { text: "자주성을 되찾기 위한 움직임(삼별초 등)을 지원하고 전통을 지킨다.", next: "goryeo_gongmin" }, // 회복
                    { text: "몽골은 강한나라이니 부끄러울 것 없다. 완전히 몽골인이 된다.", next: "end_culture_lost" },
                    { text: "원나라 황제의 눈에 들어 출세하는 데만 신경 쓴다.", next: "end_traitor" }
                ]
            },
            crisis_japan_invasion: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 태풍과 침몰",
                desc: "몽골의 강요로 무리하게 일본 원정에 나섰다가 태풍(가미카제)을 만나 배가 모두 침몰했습니다. 고려의 국력만 소진되었습니다.",
                choices: [
                    { text: "살아남은 병력을 수습하여 본국으로 돌아와 내실을 다진다.", next: "goryeo_gongmin" }, // 회복
                    { text: "일본에 상륙하여 죽을 때까지 싸운다.", next: "end_bad_tactic" },
                    { text: "바다에 몸을 던진다.", next: "end_leaderless" }
                ]
            },

            goryeo_gongmin: {
                type: 'history', badge: 'badge-goryeo', era: "고려 말", year: "1351년",
                title: "공민왕의 자주 개혁",
                desc: "원나라(몽골)의 세력이 약해진 틈을 타 공민왕은 고려의 자주성을 되찾으려 합니다. 친원파(원나라랑 친하게 지내고자 하는 신하들) 권문세족들이 반발하고 있습니다.",
                progress: 50, icon: "👑",
                choices: [
                    { text: "친원 세력(원나라랑 친하게 지내자고 주장하는 세력)을 숙청하고, 빼앗긴 영토를 되찾는다.", next: "joseon_wihwado" },
                    { text: "아직 원나라가 무섭다. 의리를 지키며 계속 공녀를 바친다.", next: "end_yuan_province" },
                    { text: "승려 신돈에게 모든 권력을 주고 자신은 뒤로 물러난다.", next: "crisis_monk_power" }
                ]
            },
            crisis_monk_power: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 요승의 전횡",
                desc: "신돈이 초기에는 개혁을 잘하는가 싶더니, 점점 권력을 함부로 사용하여 조정이 혼란에 빠졌습니다. 보수 세력의 반발이 극심합니다.",
                choices: [
                    { text: "신돈을 제거하고 왕이 직접 개혁을 주도한다.", next: "joseon_wihwado" }, // 회복
                    { text: "개혁을 모두 취소하고 다시 원나라에 기댄다.", next: "end_yuan_province" },
                    { text: "정치를 포기하고 그림(천산대렵도)만 그린다.", next: "end_weakness" }
                ]
            },

            // ==========================================
            // 5. 조선 시대
            // ==========================================
            joseon_wihwado: {
                type: 'history', badge: 'badge-joseon', era: "여말선초", year: "1388년",
                title: "위화도 회군",
                desc: "명나라가 요동 정벌을 요구하자 최영 장군은 이성계를 보냈습니다. 하지만 장마철이라 활의 아교가 녹고 병사들이 지쳤습니다. 압록강 위화도에서 이성계는 운명적인 결정을 내려야 합니다.",
                progress: 55, icon: "🐴",
                choices: [
                    { text: "4가지 불가론을 내세워 군대를 돌려(회군) 정권을 잡는다.", next: "joseon_sejong_science" },
                    { text: "왕명에 따라야 하므로 군사들을 잘 달래 요동을 공격하고 명나라와 전면전을 벌인다.", next: "end_ming_war" },
                    { text: "군대를 해산하고 고향으로 돌아가 조용히 농사를 짓는다.", next: "end_farmer" }
                ]
            },

            // [추가] 세종대왕 과학 기술 (장영실)
            joseon_sejong_science: {
                type: 'history', badge: 'badge-joseon', era: "조선 초기", year: "1434년",
                title: "세종대왕과 과학 기술",
                desc: "세종대왕은 백성들의 삶을 윤택하게 하기 위해 과학 기술에도 큰 관심을 기울입니다. 노비 출신인 장영실의 뛰어난 재주를 알아본 왕은 신하들의 반대를 무릅쓰고 그를 등용하려 합니다.",
                progress: 58, icon: "🔭",
                choices: [
                    { text: "신분보다 능력이 우선이다. 장영실을 등용하여 자격루, 측우기 등을 만들게 한다.", next: "joseon_sejong", unlock: 'great_scientist' },
                    { text: "법도는 지켜져야 한다. 천민을 관직에 앉힐 수 없다.", next: "crisis_no_science" },
                    { text: "직접 과학 기술을 개발하기는 어려우니 명나라의 과학 기술을 잘 받아들이기로 한다.", next: "end_culture_lost" }
                ]
            },
            crisis_no_science: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 정체된 기술",
                desc: "과학 기술 발전이 더뎌져 농업 생산량이 늘지 않고, 가뭄과 홍수에 대비하지 못해 백성들이 고통받습니다.",
                choices: [
                    { text: "지금이라도 인재를 널리 찾아 과학 기구를 개발한다.", next: "joseon_sejong" }, // 회복
                    { text: "하늘의 뜻이라 여기고 상황을 나아지게 하기 위해 비를 내리게 해달라고 요구하는 제사인 기우제를 지낸다.", next: "end_weakness" },
                    { text: "과학 기술 발전이 시급하니 더 세금을 걷는다.", next: "end_tyrant" }
                ]
            },

            joseon_sejong: {
                type: 'history', badge: 'badge-joseon', era: "조선 초기", year: "1443년",
                title: "세종대왕의 애민정신",
                desc: "조선의 황금기입니다. 하지만 백성들은 어려운 한자를 몰라 억울한 일을 당해도 호소하지 못합니다. 세종은 누구나 쉽게 배우는 글자를 만들고 싶지만, 최만리 등 신하들은 중국을 거스르는 일이라며 반대합니다.",
                progress: 60, icon: "📖",
                choices: [
                    { text: "백성을 가르치는 바른 소리, '훈민정음'을 창제하고 반포한다.", next: "joseon_imjin" },
                    { text: "중국을 섬기는 사대주의에 입각해 한글 창제를 포기한다.", next: "crisis_no_hangul" },
                    { text: "한자를 더 어렵게 만들어 양반들만의 지식을 강화한다.", next: "end_elite_society" }
                ]
            },
            crisis_no_hangul: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 까막눈 백성",
                desc: "쉬운 글자가 없어 백성들은 전염병 예방법도, 농사법도 읽지 못해 죽어갑니다. 지식은 양반들의 전유물이 되어 사회 발전이 정체되었습니다.",
                choices: [
                    { text: "지금이라도 한글을 만들고 보급한다.", next: "joseon_imjin" }, // 회복
                    { text: "백성이 똑똑해지면 다루기 힘들다. 더 쉽게 나라를 다스리기 위해 그대로 둔다", next: "end_elite_society" },
                    { text: "중국어를 공용어로 지정한다.", next: "end_culture_lost" }
                ]
            },

            joseon_imjin: {
                type: 'history', badge: 'badge-joseon', era: "조선 중기", year: "1592년",
                title: "임진왜란",
                desc: "일본이 대규모로 침략했습니다. 부산진과 동래성이 순식간에 함락되고 선조는 한양을 버리고 피란을 떠났습니다. 나라가 망하기 직전, 바다를 지키는 이순신 장군은 결단을 내려야 합니다.",
                progress: 65, icon: "🐢",
                choices: [
                    { text: "한산도 앞바다로 적을 유인해 학익진을 펼쳐 궤멸시키고 보급로를 끊는다.", next: "joseon_gwanghae" },
                    { text: "바다를 버리고 육지로 올라가 왕을 호위한다.", next: "crisis_lost_sea" },
                    { text: "일본 수군과 정면 승부하여야 기세를 꺾을 수 있다 무조건 돌격하여 공격한다.", next: "end_bad_tactic" }
                ]
            },
            crisis_lost_sea: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 바다를 내주다",
                desc: "제해권을 잃자 일본군은 서해를 통해 한양으로 식량과 무기를 펑펑 실어 나릅니다. 조선군은 굶주리고 일본군은 배불리 먹으며 진격합니다.",
                choices: [
                    { text: "명량에서 남은 12척으로 기적적인 승리를 거두어 전세를 뒤집는다.", next: "joseon_gwanghae" }, // 회복
                    { text: "산속으로 숨어 소규모 의병 활동만 한다.", next: "end_bad_tactic" },
                    { text: "일본에 항복한다.", next: "end_traitor" }
                ]
            },

            joseon_gwanghae: {
                type: 'history', badge: 'badge-joseon', era: "조선 중기", year: "1610년",
                title: "광해군의 중립 외교",
                desc: "임진왜란으로 피폐해진 조선. 북쪽에서는 여진족이 세운 후금(청)이 강성해지고, 쇠퇴하는 명나라는 조선에 군대를 보내달라고 요구합니다. 명분과 실리 사이에서 선택해야 합니다.",
                progress: 68, icon: "⚖️",
                choices: [
                    { text: "명에 군대를 보내되, 후금에는 싸울 뜻이 없음을 알리는 중립 외교를 펼친다.", next: "joseon_manchu" },
                    { text: "임진왜란 때 도와준 명나라를 위해 전력을 다해 후금과 싸운다.", next: "crisis_manchu_invasion_early" },
                    { text: "떠오르는 태양인 후금과 손잡고 명나라를 공격한다.", next: "crisis_ming_revenge" }
                ]
            },
            crisis_manchu_invasion_early: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 후금의 분노",
                desc: "후금이 조선을 적으로 간주하고 대군을 이끌고 쳐들어왔습니다. 전쟁의 상처가 아물기도 전에 또 전쟁입니다. 준비가 안 된 조선군은 속수무책입니다.",
                choices: [
                    { text: "강화도로 피신하여 항전하며 훗날을 도모한다.", next: "joseon_manchu" }, // 회복
                    { text: "무조건 항복한다.", next: "end_joseon_fall" },
                    { text: "명나라로 도망친다.", next: "end_coward" }
                ]
            },
            crisis_ming_revenge: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 명의 보복",
                desc: "부모의 나라라 섬기던 명이 배신감을 느끼고 경제 제재를 가합니다. 사대부들은 '패륜'이라며 왕을 비난하고 반란을 꾀합니다.",
                choices: [
                    { text: "중립을 지키려 했다고 해명하고 실리를 챙긴다.", next: "joseon_manchu" }, // 회복
                    { text: "후금 편을 드는 것이 낫다고 계속 주장하며 나의 의견을 굽히지 않는다.", next: "joseon_manchu" }, // 역사적 흐름으로 합류
                    { text: "후금의 속국이 되기를 자처한다.", next: "end_traitor" }
                ]
            },

            joseon_manchu: {
                type: 'history', badge: 'badge-joseon', era: "조선 중기", year: "1636년",
                title: "병자호란",
                desc: "인조반정으로 광해군이 쫓겨나고, 친명배금(명나라와 친하게 지내고 후금과 가까이 하지 않는) 정책을 쓰자 청나라(후금)가 쳐들어왔습니다. 인조는 남한산성에 고립되어 춥고 배고픈 겨울을 보내고 있습니다. 강화도마저 함락되었습니다.",
                progress: 70, icon: "❄️",
                choices: [
                    { text: "치욕스럽지만 항복하여 왕조와 백성을 보존한다.", next: "joseon_yeongjo" },
                    { text: "오랑캐에게 무릎 꿇을 수 없다. 끝까지 싸운다.", next: "end_joseon_fall" },
                    { text: "싸우다 죽는 것은 두려우니 자결한다.", next: "end_leaderless" }
                ]
            },

            joseon_yeongjo: {
                type: 'history', badge: 'badge-joseon', era: "조선 후기", year: "18세기",
                title: "탕평책과 조선의 르네상스",
                desc: "신하들이 동인, 서인, 노론, 소론으로 나뉘어 권력 다툼(붕당 정치)을 하느라 민생은 뒷전입니다. 영조와 정조는 이 고질적인 병폐를 고치려 합니다.",
                progress: 75, icon: "🏛️",
                choices: [
                    { text: "어느 한 쪽에 치우치지 않고 인재를 고루 등용하는 탕평책을 쓴다.", next: "joseon_jeongjo" },
                    { text: "나를 지지하는 특정 붕당의 편만 든다.", next: "crisis_faction" },
                    { text: "골치 아픈 정치는 신하들에게 맡기고 포기한다.", next: "crisis_weak_governance" }
                ]
            },
            crisis_faction: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 세도 정치의 서막",
                desc: "한 정파가 권력을 독점하자 견제 장치가 사라졌습니다. 매관매직이 성행하고 지방 관리들이 마음대로 행동하여 백성들의 생활이 크게 어려워집니다.",
                choices: [
                    { text: "규장각을 설치하여 젊은 인재를 키우고 붕당의 균형을 맞춘다.", next: "joseon_jeongjo" }, // 회복
                    { text: "백성들의 고혈을 짜내어 사치향락을 즐긴다.", next: "end_tyrant" },
                    { text: "반대파를 모두 귀양 보낸다.", next: "crisis_faction" } // 루프지만 선택지 제공
                ]
            },
            crisis_weak_governance: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 민란의 시대",
                desc: "나라가 기능을 멈추자 참다못한 농민들이 죽창을 들고 일어났습니다. 홍경래의 난을 시작으로 전국이 불타오릅니다.",
                choices: [
                    { text: "나라의 혼란을 바로잡고 암행어사를 파견해 민생을 챙긴다.", next: "joseon_jeongjo" }, // 회복
                    { text: "군대를 보내 무자비하게 진압하여 나라를 안정시킨다.", next: "end_tyrant" },
                    { text: "왕궁 문을 걸어 잠그고 모른 척한다.", next: "end_joseon_fall" }
                ]
            },

            // [추가 시나리오 3: 정조]
            joseon_jeongjo: {
                type: 'history', badge: 'badge-joseon', era: "조선 후기", year: "1794년",
                title: "정조의 개혁과 수원 화성",
                desc: "정조 대왕은 아버지 사도세자의 묘를 옮기고, 강력한 왕권을 상징하는 신도시 '수원 화성'을 건설하려 합니다. 정약용이 거중기를 발명하여 공사를 돕고 있습니다.",
                progress: 77, icon: "🏰",
                choices: [
                    { text: "화성을 완공하여 상업과 국방의 중심지로 삼고 개혁을 완성한다.", next: "joseon_silhak", unlock: 'reformer' },
                    { text: "돈이 너무 많이 드니 공사를 중단한다.", next: "crisis_weak_king" },
                    { text: "반대하는 노론 벽파를 모두 처형하고 공포 정치를 한다.", next: "end_tyrant" }
                ]
            },
            crisis_weak_king: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 멈춘 개혁",
                desc: "개혁이 중단되자 기득권 세력이 다시 득세하여 왕권이 약화되었습니다. 백성들의 삶은 나아지지 않았습니다.",
                choices: [
                    { text: "규장각을 통해 젊은 인재를 등용하여 다시 개혁의 불씨를 살린다.", next: "joseon_silhak" }, // 회복
                    { text: "왕위를 내놓고 물러난다.", next: "end_weakness" },
                    { text: "힘 센 신하들에게 나라를 맡긴다.", next: "crisis_faction" }
                ]
            },

            joseon_silhak: {
                type: 'history', badge: 'badge-joseon', era: "조선 후기", year: "19세기 초",
                title: "실학의 대두",
                desc: "공자 왈 맹자 왈 하는 백성들의 생황과는 직접적 관련이 없는 학문 대신, 농업과 상공업 등 실생활에 도움이 되는 '실학'이 등장했습니다. 김정호는 전국을 돌며 정밀한 지도를 만들었습니다.",
                progress: 78, icon: "🗺️",
                choices: [
                    { text: "정확한 '대동여지도'를 보급하여 상공업과 국방에 활용한다.", next: "modern_daewon" },
                    { text: "지도는 적에게 이용될 수 있는 국가 기밀이니 태워버린다.", next: "crisis_ignorance" },
                    { text: "서양 기술은 오랑캐의 것이니 절대 배우지 않는다.", next: "crisis_tech_lag" }
                ]
            },
            crisis_ignorance: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 깜깜이 나라",
                desc: "국토에 대한 정보가 없어 물류 유통이 막히고, 적이 쳐들어와도 길을 몰라 막을 수가 없습니다.",
                choices: [
                    { text: "실학자들의 연구를 지원하여 나라의 눈과 귀를 밝힌다.", next: "modern_daewon" }, // 회복
                    { text: "옛날 지도가 정확하니 옛 문헌을 조사한다.", next: "crisis_tech_lag" },
                    { text: "외국 지도를 몰래 비싼 값에 사온다.", next: "end_culture_lost" }
                ]
            },
            crisis_tech_lag: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 기술 격차",
                desc: "서양은 증기선을 만들고 산업혁명을 일으키는데, 우리는 아직도 낡은 농기구에 의존하고 있습니다. 국력 차이가 벌어집니다.",
                choices: [
                    { text: "북학파의 주장을 받아들여 청나라와 서양의 문물을 적극 배운다.", next: "modern_daewon" }, // 회복
                    { text: "성리학만이 살길이라며 기술을 천시(무시)한다.", next: "end_elite_society" },
                    { text: "모든 기술자를 천민 취급한다.", next: "end_weakness" }
                ]
            },

            // ==========================================
            // 6. 근대 및 일제 강점기
            // ==========================================
            modern_daewon: {
                type: 'history', badge: 'badge-modern', era: "구한말", year: "1866년",
                title: "흥선대원군과 척화비",
                desc: "모양도 이상한 서양 배(이양선)가 해안가에 나타나 통상을 요구합니다. 그들은 무력을 앞세워 위협하고 있습니다. 흥선대원군은 선택의 기로에 섰습니다.",
                progress: 80, icon: "🔒",
                choices: [
                    { text: "서양 오랑캐와 화친하는 것은 매국이다. 척화비를 세우고 거부한다.", next: "modern_gapsin" },
                    { text: "대세는 개항이다. 즉시 문호를 개방한다.", next: "crisis_early_colonization" },
                    { text: "청나라에 나라를 바치고 보호를 요청한다.", next: "end_qing_province" }
                ]
            },
            crisis_early_colonization: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 준비 없는 개항",
                desc: "아무 준비 없이 문을 열자 서양 상인들이 경제를 잠식하고, 불평등 조약을 강요하여 관세 자주권마저 잃었습니다.",
                choices: [
                    { text: "지금이라도 자주적 개혁을 시도하고 신식 군대를 기른다.", next: "modern_gapsin" }, // 회복
                    { text: "나라를 팔아먹고 나만 부자가 된다.", next: "end_traitor" },
                    { text: "다시 문을 닫으려 한다.", next: "end_colony_imperial" } // 식민지 엔딩 재활용
                ]
            },

            modern_gapsin: {
                type: 'history', badge: 'badge-modern', era: "개항기", year: "1884년",
                title: "갑신정변",
                desc: "청나라의 내정 간섭이 심해지자, 김옥균 등 급진 개화파는 우정총국 개국 축하연을 틈타 정변을 일으켰습니다. 근대 국가를 향한 짧고 강렬한 시도입니다.",
                progress: 83, icon: "📮",
                choices: [
                    { text: "인민 평등과 근대 국가 수립의 의지를 보여주기 위해 개혁방법을 제시한다.", next: "modern_donghak" },
                    { text: "일본군을 믿고 끝까지 시가전을 벌인다.", next: "crisis_civil_war" },
                    { text: "정변을 포기하고 청나라 장군 앞에 무릎 꿇고 사죄한다.", next: "crisis_subservience" }
                ]
            },
            crisis_civil_war: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 한양의 화염",
                desc: "청나라 군대와 일본 군대가 한양 한복판에서 충돌하여 도성이 불바다가 되었습니다. 백성들이 죽어나갑니다.",
                choices: [
                    { text: "텐진 조약을 맺고 양국 군대를 철수시킨다.", next: "modern_donghak" }, // 회복
                    { text: "일본 편에 서서 청나라와 싸운다.", next: "end_traitor" },
                    { text: "도망친다.", next: "end_coward" }
                ]
            },
            crisis_subservience: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 사대주의의 부활",
                desc: "청나라의 내정 간섭이 극에 달해 조선의 자주권이 사실상 사라졌습니다. 조선 왕은 청나라 관리의 눈치만 봅니다.",
                choices: [
                    { text: "동학 농민군과 손잡고 아래로부터의 개혁으로 외세를 몰아내려 한다.", next: "modern_donghak" }, // 회복
                    { text: "청나라의 속국이 된다.", next: "end_qing_province" },
                    { text: "일본을 끌어들여 청을 견제한다 (이이제이).", next: "crisis_civil_war" }
                ]
            },

            modern_donghak: {
                type: 'history', badge: 'badge-modern', era: "개항기", year: "1894년",
                title: "동학 농민 운동",
                desc: "탐관오리의 횡포에 참다못한 농민들이 전봉준을 중심으로 일어났습니다. '사람이 곧 하늘이다(인내천)'라는 기치 아래, 낡은 세상을 뒤엎으려 합니다.",
                progress: 85, icon: "🌾",
                choices: [
                    { text: "외군군이 조선에 들어올 수 있으니 정부의 말을 받아들여 일단 해산했다가 혹시 모를 외국군의 침략에 대비한다.", next: "modern_eulsa" },
                    { text: "나라가 혼란스러우니 곧바로 무기를 버리고 해산한다.", next: "crisis_peasant_fail" },
                    { text: "왕조를 부정하고 농민들만의 공화국을 선포한다.", next: "crisis_republic_fail" }
                ]
            },
            crisis_peasant_fail: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 미완의 혁명",
                desc: "농민군이 흐지부지 해산하자 탐관오리의 횡포가 다시 시작되었습니다. 개혁의 불씨가 꺼졌습니다.",
                choices: [
                    { text: "2차 봉기를 일으켜 항일 구국 투쟁을 한다.", next: "modern_eulsa" }, // 회복
                    { text: "산속에 숨어 지낸다.", next: "end_coward" },
                    { text: "일본군에 투항한다.", next: "end_traitor" }
                ]
            },
            crisis_republic_fail: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 고립된 이상",
                desc: "너무 급진적인 주장에 양반과 일반 백성들이 등을 돌렸습니다. 고립된 농민군은 토벌대에 의해 진압되었습니다.",
                choices: [
                    { text: "외국군에 저항하기 위해 민족의 단결을 호소한다.", next: "modern_eulsa" }, // 회복
                    { text: "우리끼리만 잘 사는 마을을 만든다.", next: "end_weakness" },
                    { text: "약탈을 일삼아 도적떼가 된다.", next: "end_savage" }
                ]
            },

            modern_eulsa: {
                type: 'history', badge: 'badge-modern', era: "대한제국", year: "1905년",
                title: "을사늑약의 비극",
                desc: "일본이 군대를 앞세워 궁궐을 포위하고, 대한제국의 외교권을 박탈하는 조약에 강제로 서명하게 했습니다. 나라가 망하기 일보 직전입니다.",
                progress: 88, icon: "🥀",
                choices: [
                    { text: "헤이그에 특사를 파견해 부당함을 알리고, 전국에서 의병을 일으켜 저항한다.", next: "modern_gukchae" },
                    { text: "어쩔 수 없다. 도장을 찍고 일본의 보호국이 된다.", next: "end_traitor" },
                    { text: "러시아 황제에게 도움을 요청하여 러시아로 도망친다.", next: "crisis_exile" }
                ]
            },
            crisis_exile: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 망명 정부",
                desc: "황제가 나라를 버리고 떠나자 구심점을 잃은 국내는 빠르게 일본에 잠식당했습니다. 백성들은 버려졌다는 절망감에 빠졌습니다.",
                choices: [
                    { text: "최대한 빨리 다시 대한제국으로 돌아가 나라를 정상화 시키기 위해 노력한다.", next: "modern_gukchae" }, // 회복
                    { text: "러시아 시민이 되어 편하게 산다.", next: "end_coward" },
                    { text: "일본에 항복한다.", next: "end_traitor" }
                ]
            },

            // [추가 시나리오 4: 국채보상운동]
            modern_gukchae: {
                type: 'history', badge: 'badge-modern', era: "대한제국", year: "1907년",
                title: "국채보상운동",
                desc: "일본은 대한제국에 강제로 돈을 빌려주어 경제적으로 꼼짝못하게 하려고 합니다. 나랏빚이 1,300만 원(그 당시 나라의 1년치 예산보다 많은 돈)에 달해 나라가 망할 위기에 처했습니다. 대구에서 시작된 운동이 전국으로 퍼집니다.",
                progress: 89, icon: "💰",
                choices: [
                    { text: "남자는 담배를 끊고 여자는 비녀를 팔아 나랏빚을 갚자고 호소한다.", next: "colonial_an", unlock: 'patriot' },
                    { text: "다른 나라(영국, 미국)에 돈을 빌려 일본 빚을 갚는다.", next: "end_colony_debt" },
                    { text: "갚을 능력이 없으니 파산 선언을 한다.", next: "crisis_economic_collapse" }
                ]
            },
            end_colony_debt: { type: 'ending', title: "BAD END: 빚더미 식민지", desc: "빚을 빚으로 막으려다 서구 열강의 이권 침탈 대상이 되어 찢겨졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            crisis_economic_collapse: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 경제 파탄",
                desc: "국가 신용도가 바닥을 치고 화폐 가치가 폭락했습니다. 백성들은 굶주리고 일본 상인들이 헐값에 땅을 사들입니다.",
                choices: [
                    { text: "민족 자본을 육성하여 경제 자립을 꾀한다.", next: "colonial_an" }, // 회복
                    { text: "일본 화폐를 쓰며 경제권에 편입된다.", next: "end_assimilation" },
                    { text: "산으로 들어가 자급자족한다.", next: "end_weakness" }
                ]
            },


            colonial_an: {
                type: 'history', badge: 'badge-modern', era: "일제강점기 직전", year: "1909년",
                title: "안중근의 의거",
                desc: "조선 침략의 원흉 이토 히로부미가 하얼빈 역에 도착했습니다. 안중근 의사의 품속에는 권총이 있습니다. 방아쇠를 당기시겠습니까?",
                progress: 90, icon: "🔫",
                choices: [
                    { text: "탕! 탕! 탕! 이토를 사살하고 '코레아 우라(대한 만세)'를 외친다.", next: "colonial_march" },
                    { text: "평화적으로 대화하여 설득을 시도한다.", next: "crisis_naive" },
                    { text: "두려움에 떨며 거사를 포기하고 숨는다.", next: "end_coward" }
                ]
            },
            crisis_naive: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 순진한 생각",
                desc: "대화를 시도하려다 일본 경호원들에게 체포되었습니다. 이토는 살아남아 조선 병탄을 더욱 가속화했습니다.",
                choices: [
                    { text: "옥중에서라도 '동양평화론'을 집필하여 평화 사상을 남긴다.", next: "colonial_march" }, // 회복
                    { text: "잘못했다고 빌고 풀려난다.", next: "end_traitor" },
                    { text: "자결한다.", next: "end_leaderless" }
                ]
            },

            colonial_march: {
                type: 'history', badge: 'badge-modern', era: "일제강점기", year: "1919년",
                title: "3.1 운동",
                desc: "고종 황제의 장례일을 맞아 민족의 억눌린 분노가 폭발했습니다. 학생과 종교계가 힘을 합쳐 독립 선언서를 낭독하려 합니다.",
                progress: 92, icon: "🇰🇷",
                choices: [
                    { text: "비폭력 평화 시위로 우리 민족의 독립 의지를 전 세계에 알린다.", next: "colonial_battle" },
                    { text: "총칼에는 총칼로 맞선다. 무장 폭동을 일으킨다.", next: "crisis_violent_crackdown" },
                    { text: "계란으로 바위 치기다. 독립 운동을 그만둔다.", next: "end_assimilation" }
                ]
            },
            crisis_violent_crackdown: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 무자비한 진압",
                desc: "폭력을 쓰자 일본군은 기다렸다는 듯이 기관총을 동원해 학살을 자행했습니다. 평화 시위의 정당성을 잃고 국제 여론도 등을 돌립니다.",
                choices: [
                    { text: "상하이로 건너가 대한민국 임시정부를 수립하고 체계적으로 저항한다.", next: "colonial_battle" }, // 회복
                    { text: "더 큰 테러를 계획한다.", next: "end_bad_tactic" },
                    { text: "모두 포기한다.", next: "end_assimilation" }
                ]
            },

            colonial_battle: {
                type: 'history', badge: 'badge-modern', era: "일제강점기", year: "1920년",
                title: "청산리 대첩",
                desc: "만주로 건너간 독립군들이 일본군 정규 부대와 맞붙게 되었습니다. 김좌진 장군과 홍범도 장군은 지형을 이용한 작전을 준비합니다.",
                progress: 95, icon: "⚔️",
                choices: [
                    { text: "유인책과 매복 작전으로 일본군을 대파하여 독립 전쟁 사상 최대 승리를 거둔다.", next: "colonial_language" },
                    { text: "일본군의 전력이 너무 강하니 전투를 피하고 흩어진다.", next: "crisis_scattered" },
                    { text: "소련의 지원을 믿고 소련군 아래로 들어간다.", next: "crisis_soviet_betrayal" }
                ]
            },
            crisis_scattered: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 각개격파",
                desc: "흩어진 독립군 부대들은 일본군의 끈질긴 토벌 작전에 하나둘씩 무너집니다. 구심점을 잃었습니다.",
                choices: [
                    { text: "다시 3부가 통합하여 국민부를 결성하고 전열을 정비한다.", next: "colonial_language" }, // 회복
                    { text: "도적단이 되어 약탈을 일삼는다.", next: "end_savage" },
                    { text: "일본군에 투항한다.", next: "end_traitor" }
                ]
            },
            crisis_soviet_betrayal: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 자유시 참변",
                desc: "믿었던 소련군이 독립군의 무장 해제를 요구하며 공격했습니다. 수많은 독립군이 희생되고 주력이 흩어지게 되었습니다.",
                choices: [
                    { text: "만주로 돌아와 새로 군대를 조직하여 일본과 싸울 준비를 다시 시작한다.", next: "colonial_language" }, // 회복
                    { text: "공산주의자가 되어 소련군에 들어간다.", next: "end_soviet_red" },
                    { text: "독립의 꿈을 접는다.", next: "end_assimilation" }
                ]
            },

            colonial_language: {
                type: 'history', badge: 'badge-modern', era: "일제강점기 말", year: "1940년대",
                title: "우리말 지키기 (말모이)",
                desc: "일본이 창씨개명을 강요하고 학교에서 한국어 사용을 금지했습니다. 우리말이 사라지면 민족의 정신도 사라집니다. 조선어학회 학자들은 비밀리에 우리말 사전을 만들고 있습니다.",
                progress: 97, icon: "📙",
                choices: [
                    { text: "모진 고문과 탄압을 무릅쓰고 우리말 큰사전 원고를 지켜낸다.", next: "liberation_day" },
                    { text: "일본어가 국어가 되었으니 어쩔 수 없다. 한글 연구를 포기한다.", next: "end_culture_lost" },
                    { text: "들키면 죽는다. 모든 원고를 불태우고 증거를 없앤다.", next: "crisis_history_erased" }
                ]
            },
            crisis_history_erased: {
                type: 'crisis', badge: 'badge-crisis', title: "위기: 얼빠진 민족",
                desc: "말과 글이 사라지자 우리의 역사와 정신도 희미해져 갑니다. 사람들은 창씨개명한 이름으로 서로를 부르며 일본인으로 동화되기 직전입니다.",
                choices: [
                    { text: "해방 직전, 서울역 창고에서 기적적으로 원고를 찾아 편찬한다.", next: "liberation_day" }, // 극적 회복
                    { text: "일본어를 모국어로 받아들인다.", next: "end_culture_lost" },
                    { text: "만주로 떠나 우리말을 쓰는 마을을 만든다.", next: "end_coward" }
                ]
            },

            // ==========================================
            // 7. 엔딩 (광복)
            // ==========================================
            liberation_day: {
                type: 'ending', badge: 'badge-modern', era: "대한민국", year: "1945년 8월 15일",
                title: "🎉 광복, 그리고 새로운 시작",
                desc: "1945년 8월 15일, 라디오에서 일본 천황의 항복 방송이 흘러나옵니다. 거리로 뛰쳐나온 사람들은 태극기를 흔들며 '대한 독립 만세'를 외칩니다.<br><br>당신의 끈질긴 투쟁과 올바른 선택 덕분에 우리 민족은 빛을 되찾았습니다(光復). 수많은 선조들의 피와 땀이 헛되지 않았습니다. 역사의 수호자여, 수고하셨습니다!",
                progress: 100, icon: "🌞",
                unlock: 'history_guardian',
                choices: [{ text: "위대한 여정을 다시 시작하기", next: "start", style: "restart" }]
            },

            // === 배드 엔딩들 (완전 실패) ===
            end_fail_founding: { type: 'ending', title: "BAD END: 건국 실패", desc: "고난을 이겨내지 못하고 나라를 세우는 것을 포기했습니다. 당신의 이름은 잊혀졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_vassal_goguryeo: { type: 'ending', title: "BAD END: 고구려의 속국", desc: "자주성을 버리고 고구려의 지배를 받는 신세가 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_vassal_baekje: { type: 'ending', title: "BAD END: 백제의 깃발 아래", desc: "백제에게 패권을 넘겨주고 그들의 신하가 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_exile_ancient: { type: 'ending', title: "BAD END: 바다 건너 도피", desc: "한반도를 버리고 일본으로 도망쳤습니다. 고향의 역사는 당신 없이 흘러갑니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_vassal_generic: { type: 'ending', title: "BAD END: 대국의 그늘", desc: "중국 왕조의 신하를 자처하여 독자적인 천하관을 잃어버렸습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_vassal_jurchen: { type: 'ending', title: "BAD END: 여진의 형제국", desc: "여진족에게 머리를 숙이고 땅을 내주었습니다. 북방의 호랑이는 이제 고려를 얕잡아 봅니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_colony_imperial: { type: 'ending', title: "BAD END: 서구 열강의 먹잇감", desc: "준비 없이 문을 열어 서양 세력의 경제적, 정치적 식민지가 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_soviet_red: { type: 'ending', title: "BAD END: 붉은 군대", desc: "소련군에 편입되어 민족의 독립보다는 이념을 따르는 삶을 살게 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            
            end_myth_fail: { type: 'ending', title: "BAD END: 신화의 끝", desc: "단군 신화는 시작되지 못했습니다. 한반도는 문명화되지 못했습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_savage: { type: 'ending', title: "BAD END: 야만의 시대", desc: "법과 질서 대신 폭력만이 남은 세상이 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_tyrant: { type: 'ending', title: "BAD END: 폭군의 말로", desc: "백성을 억압한 국가는 오래가지 못하고 무너졌습니다.", unlock: 'tyrant', choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_buyeo_sub: { type: 'ending', title: "BAD END: 잊혀진 부여", desc: "고구려는 건국되지 못했고 부여의 변방 부족으로 남았습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_bad_tactic: { type: 'ending', title: "BAD END: 무모한 패배", desc: "용기만 있고 지략이 없는 싸움은 패배로 끝났습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_sui_colony: { type: 'ending', title: "BAD END: 중원의 식민지", desc: "한반도는 중국 왕조의 일개 군현으로 전락했습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_tang_vassal: { type: 'ending', title: "BAD END: 당의 계림도독부", desc: "자주적인 통일을 이루지 못하고 당나라의 지배를 받게 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_no_balhae: { type: 'ending', title: "BAD END: 잃어버린 만주", desc: "발해가 세워지지 않아 만주 지역의 우리 역사는 사라졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_weakness: { type: 'ending', title: "BAD END: 나약한 국가", desc: "스스로를 지킬 힘이 없는 나라는 결국 잡아먹혔습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_coward: { type: 'ending', title: "BAD END: 비겁한 변명", desc: "도망친 곳에 낙원은 없습니다. 역사는 당신을 기억하지 않을 것입니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_colony_khitan: { type: 'ending', title: "BAD END: 유목민의 목초지", desc: "고려는 사라지고 거란족의 말들이 뛰노는 땅이 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_traitor: { type: 'ending', title: "BAD END: 씻을 수 없는 오명", desc: "매국노라는 이름은 영원히 역사에 남을 것입니다.", unlock: 'traitor', choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_barbaric: { type: 'ending', title: "BAD END: 문명의 퇴보", desc: "지식을 천시한 결과 국가는 야만 상태로 돌아갔습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_culture_lost: { type: 'ending', title: "BAD END: 얼빠진 민족", desc: "말과 글, 정신을 잃어버린 민족에게 미래는 없습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_yuan_province: { type: 'ending', title: "BAD END: 정동행성", desc: "고려는 원나라의 일개 행정구역이 되어 사라졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_ming_war: { type: 'ending', title: "BAD END: 불가능한 전쟁", desc: "신생국 명나라와의 전면전으로 국토가 황폐화되고 멸망했습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_farmer: { type: 'ending', title: "BAD END: 평범한 농부", desc: "이성계가 낙향하자 고려는 혼란 속에 권문세족의 나라로 남았습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_elite_society: { type: 'ending', title: "BAD END: 그들만의 리그", desc: "지식이 독점된 사회는 발전하지 못하고 내부에서 썩어 문드러졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_leaderless: { type: 'ending', title: "BAD END: 구심점 상실", desc: "지도자가 사라진 국가는 모래알처럼 흩어졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_joseon_fall: { type: 'ending', title: "BAD END: 조선의 멸망", desc: "조선 왕조는 역사 속으로 사라졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_qing_province: { type: 'ending', title: "BAD END: 청의 속방", desc: "조선은 자주국이 아닌 청나라의 지방 정권이 되었습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] },
            end_assimilation: { type: 'ending', title: "BAD END: 내선일체", desc: "독립 의지가 꺾여 일본인으로 동화되었습니다. 한국은 영영 사라졌습니다.", choices: [{ text: "다시 도전", next: "start", style: "restart" }] }
        };

        // 데이터 누락 방지를 위한 안전 장치
        function getSafeData(key) {
            if (gameData[key]) return gameData[key];
            console.error(`Missing key: ${key}`); // 개발자 확인용
            return {
                type: 'ending', badge: 'badge-crisis', era: "시스템 오류", year: "???",
                title: "차원의 틈새",
                desc: "죄송합니다. 치명적인 오류가 발생했습니다. (연결되지 않은 시나리오)",
                progress: 0, icon: "👾",
                choices: [{ text: "처음으로 돌아가기", next: "start", style: "restart" }]
            };
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- 웅녀 미니게임 로직 ---
        let mgInterval;
        let mgScore = 0;
        let mgActive = false;
        let mgNextScene = "";

        function startMinigame(gameType, nextScene) {
            if (gameType !== 'bear_game') return;

            mgNextScene = nextScene;
            mgScore = 0;
            mgActive = true;

            const overlay = document.getElementById('minigame-overlay');
            const scoreEl = document.getElementById('mg-score');
            const resultEl = document.getElementById('mg-result');
            const gameArea = document.getElementById('mg-game-area');

            overlay.style.display = 'block';
            resultEl.classList.add('hidden');
            scoreEl.textContent = '0';
            gameArea.innerHTML = ''; // 기존 아이템 제거

            // 게임 루프 시작 (0.4초마다 생성)
            mgInterval = setInterval(spawnItem, 400);
        }

        function spawnItem() {
            if (!mgActive) return;

            const gameArea = document.getElementById('mg-game-area');
            const items = [
                { src: 'garlic.png', type: 'good' },
                { src: 'Mugwort.png', type: 'good' },
                { src: 'meat.png', type: 'bad' },
                { src: 'byu.png', type: 'bad' }
            ];

            const itemData = items[Math.floor(Math.random() * items.length)];
            
            const img = document.createElement('img');
            img.src = itemData.src;
            img.className = 'falling-item';
            
            // 랜덤 위치
            const x = Math.random() * (window.innerWidth - 80);
            img.style.left = `${x}px`;
            
            // 랜덤 속도
            const duration = 2 + Math.random() * 3;
            img.style.animationDuration = `${duration}s`;

            const clickHandler = (e) => {
                if (!mgActive) return;
                
                const change = itemData.type === 'good' ? 1 : -1;
                updateScore(change);
                showScorePopup(e.clientX, e.clientY, change);
                img.remove();
            };

            img.addEventListener('mousedown', clickHandler);
            img.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                clickHandler({ clientX: touch.clientX, clientY: touch.clientY });
            }, { passive: false });

            img.addEventListener('animationend', () => img.remove());
            gameArea.appendChild(img);
        }

        function updateScore(change) {
            mgScore += change;
            if (mgScore < 0) mgScore = 0;
            
            const scoreEl = document.getElementById('mg-score');
            scoreEl.textContent = mgScore;
            
            if (mgScore >= 100) {
                endMinigame(true);
            }
        }

        function showScorePopup(x, y, change) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = change > 0 ? "+1" : "-1";
            popup.style.color = change > 0 ? "#4ade80" : "#ef4444";
            popup.style.left = `${x}px`;
            popup.style.top = `${y}px`;
            document.getElementById('minigame-overlay').appendChild(popup);
            
            popup.addEventListener('animationend', () => popup.remove());
        }

        function endMinigame(success) {
            mgActive = false;
            clearInterval(mgInterval);
            
            if (success) {
                const resultEl = document.getElementById('mg-result');
                resultEl.classList.remove('hidden');
            }
        }

        // 진행하기 버튼 이벤트
        document.getElementById('mg-proceed-btn').addEventListener('click', () => {
            document.getElementById('minigame-overlay').style.display = 'none';
            renderScene(mgNextScene);
        });

        function startGame() {
            renderScene('start');
        }

        let turnCount = 0;

        function renderScene(sceneId) {
            const data = getSafeData(sceneId);
            const container = document.getElementById('game-container');
            const choicesDiv = document.getElementById('choices');

            // 칭호 해금 체크
            if (data.unlock) {
                unlockTitle(data.unlock);
            }

            // 턴수 증가 (정사 진행일 때만)
            if (data.type === 'history') turnCount++;
            document.getElementById('turn-count').textContent = `Turn: ${turnCount}`;

            // 애니메이션 리셋
            container.classList.remove('fade-in');
            void container.offsetWidth;
            container.classList.add('fade-in');

            // 텍스트 업데이트
            document.getElementById('scene-title-header').textContent = data.title;
            document.getElementById('scene-desc').innerHTML = data.desc;
            document.getElementById('scene-icon').textContent = data.icon || "📜";
            document.getElementById('game-year').textContent = data.year || "";
            
            // 시대 뱃지 설정
            const badgeSpan = document.getElementById('current-era-badge');
            badgeSpan.className = `text-xs font-bold px-2 py-1 rounded mb-1 w-fit ${data.badge || 'bg-stone-500 text-white'}`;
            badgeSpan.textContent = data.era || (data.type === 'crisis' ? "위기 상황" : "역사의 갈림길");
            
            document.getElementById('era-name').textContent = data.era || "";

            // 진행바 업데이트
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = (data.progress || 0) + '%';
            
            if (data.type === 'crisis') {
                progressBar.className = 'h-2 transition-all duration-500 ease-out relative bg-red-600';
            } else if (data.type === 'ending' && data.progress === 100) {
                progressBar.className = 'h-2 transition-all duration-500 ease-out relative bg-blue-600';
            } else {
                progressBar.className = 'h-2 transition-all duration-500 ease-out relative bg-amber-700';
            }

            // 선택지 렌더링
            choicesDiv.innerHTML = '';
            
            let choicesToRender = [...data.choices];
            if (data.type !== 'ending') {
                choicesToRender = shuffleArray(choicesToRender);
            }

            choicesToRender.forEach(choice => {
                const btn = document.createElement('button');
                let btnClass = "w-full py-4 px-6 rounded-lg font-bold text-lg text-left mb-3 btn-card break-keep";
                
                if (choice.style === 'restart') btnClass += " btn-special";

                btn.className = btnClass;
                btn.textContent = choice.text;
                
                // 선택지 클릭 시 칭호 해금 (선택지에 unlock 속성이 있는 경우)
                btn.onclick = () => {
                    if (choice.unlock) unlockTitle(choice.unlock);
                    
                    if (choice.minigame) {
                        startMinigame(choice.minigame, choice.next);
                    } else {
                        renderScene(choice.next);
                    }
                };
                
                choicesDiv.appendChild(btn);
            });
        }
    </script>
</body>
</html>
